{% extends 'base.html' %} {% block links %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/landingPageStyle.css') }}"
/>{% endblock %}{% block title %} Search For Products {% endblock %} {% block content %}

    <div class="section-1">
          <div class="col-15">
            <span class="page-title">
              <h2>Find things you need for work.</h2>
            </span>
            <form action="/process_search" method="POST" class="search-form" autocomplete="off">

                  <input type="text" class="search-bar " name="searched" placeholder="Search..." autocomplete="false">
                  <button type="submit" class="btn search-submit ">Search</button>
              </form>
          </div>
      </div>
      <!-- <div class ="row"> -->
        <div class="container popular-items-section">
          <div class="popular-items"><h5>Popular Items</h5></div>
          
        <div class="container">
          <div class="row">
            <div class="col-md-4">
              <div class="card">
                <img src="static/img/xm4.png" class="card-img-top" alt="Product Image">
                <div class="card-body">
                  <h5 class="card-title">Headphones</h5>
                  <form action = "/process_search" method="POST" autocomplete="off">
                    <input type="text" style="visibility: hidden;" name="searched" value="headphone" >
                    <div class="text-left">
                    <button type="submit" class="btn btn-primary ">Browse</button>
                  </div>
                </form>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card">
                <img src="static/img/logitech-mice.png" class="card-img-top" alt="Product Image">
                <div class="card-body">
                  <h5 class="card-title">Mice</h5>
                  <form action = "/process_search" method="POST" autocomplete="off">
                    <input type="text" style="visibility: hidden;" name="searched" value="mouse" >
                    <div class="text-left">
                      <button type="submit" class="btn btn-primary ">Browse</button>
                    </div>
              
                </form>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card">
                <img src="static/img/jbl-earphones.png" class="card-img-top" alt="Product Image">
                <div class="card-body">
                  <h5 class="card-title">Earphones</h5>
                  <form action ="/process_search" method="POST" autocomplete="off">
                    <input type="text" style="visibility: hidden;" name="searched" value="earphone" >
                    <div class="text-left">
                      <button type="submit" class="btn btn-primary ">Browse</button>
                    </div>
                </form>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% if popular_products|length == 0 %}
          <div style="text-align: center;"><h4>There are no current recommendations.</h4></div>
          {% else %}
        <div class="row">
          {% for popular_product in popular_products %}
          <div class="col-md-4">
            <div class="card">
              
              <img src="static/img/product_imgs/{{popular_product.id}}.png" class="card-img-top" alt="Product Image">
           
              <div class="card-body">
                <h5 class="card-title">{{ popular_product.product_name }}</h5>
                
                <form action ="/process_search" method="POST" autocomplete="off">
                  <input type="text" style="visibility: hidden;" name="searched" value="{{popular_product.product_name}}" >
                  <div class="text-left">
                    <button type="submit" class="btn btn-primary ">Browse</button>
                  </div>
              </form>
              </div>
            </div>
          </div>
          {% endfor %}
          {% endif %}
         </div>
        
        
      </div>
    


    </div>
    <div id="chat-container">
      <div class="chat-header">
        <h2>Chatbot</h2>
        <span class="close-button">&times;</span>
      </div>
      <div id="chat-content"></div>
      <div class="input-container">
      <input type="text" id="message-input" placeholder="Type your message here...">
      <button id="send-button">Send</button>
    </div>
    </div>
    
    <!-- Icon to open chat -->
    <div id="chat-icon" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999; cursor: pointer;">
      <img src="/static/img/chat-icon.png" alt="Chat Icon" width="50">
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function() {
          const chatContainer = document.getElementById('chat-container');
          const messageInput = document.getElementById('message-input');
          const sendButton = document.getElementById('send-button');
          const chatIcon = document.getElementById('chat-icon');
          const chatContent = document.getElementById('chat-content');
          const closeButton = document.querySelector('.close-button');



          // Function to display messages in the chat window
          function displayMessage(message, sender) {
              // const messageElement = document.createElement('div');
              // messageElement.textContent = `${sender}: ${message}`;
              // chatContainer.appendChild(messageElement);
              // chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to bottom
              const messageDiv = document.createElement('div');
    messageDiv.classList.add('message');
    
    const senderElement = document.createElement('div');
    senderElement.textContent = sender + ': ';
    senderElement.classList.add('sender');
    
    const messageElement = document.createElement('div');
    messageElement.textContent = message;
    messageElement.classList.add('message-text');
    
    messageDiv.appendChild(senderElement);
    messageDiv.appendChild(messageElement);
    
    chatContent.appendChild(messageDiv);
    chatContent.scrollTop = chatContent.scrollHeight; // Scroll to bottom
          }

            // Show chat when chat icon is clicked
  chatIcon.addEventListener('click', function() {
    chatContainer.style.display = 'block';
    chatIcon.style.display = 'none'; 
  });

  // Hide chat and show chat icon when close button is clicked
  closeButton.addEventListener('click', function() {
    chatContainer.style.display = 'none';
    chatIcon.style.display = 'block'; 
  });

          // Function to send message to the backend
          function sendMessage() {
              const message = messageInput.value;
              if (message.trim() === '') return; // Ignore empty messages

              // Send message to backend
              fetch('/chatbot', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({ message: message })
              })
              .then(response => response.json())
              .then(data => {
                  // Display chatbot's response
                  displayMessage(data.chatbot_response, 'Chatbot');
                  // Display product recommendations
                  if (data.recommendations.length > 0) {
                      displayMessage('Here are some product recommendations:', 'Chatbot');
                      data.recommendations.forEach(product => {
                          displayMessage(product, 'Chatbot');
                      });
                  }
              })
              .catch(error => {
                  console.log('Error sending message:', error);
                  displayMessage('An error occurred. Please try again.', 'Chatbot');
              });

              // Clear message input
              messageInput.value = '';
          }

          // Send message when Send button is clicked
          sendButton.addEventListener('click', sendMessage);

          // Send message when Enter key is pressed in the input field
          messageInput.addEventListener('keypress', function(event) {
              if (event.key === 'Enter') {
                  sendMessage();
              }
          });

          // Initial greeting from the chatbot
          displayMessage('Hello! How can I assist you?', 'Chatbot');
      });
  </script>
  
{% endblock %}
